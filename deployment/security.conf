# Security Configuration for Futures Charting Application
#
# This file contains security best practices and configurations
# for production deployment

# ============================================================================
# 1. ENVIRONMENT VARIABLES
# ============================================================================
# Never commit sensitive values to version control
# Use environment variables or secrets management

# Required environment variables:
# - IB_HOST=127.0.0.1
# - IB_PORT=7497
# - IB_CLIENT_ID=1
# - SECRET_KEY=<generate-random-secret>
# - ALLOWED_ORIGINS=https://yourdomain.com
# - DATABASE_URL=<if-using-database>

# ============================================================================
# 2. CORS CONFIGURATION
# ============================================================================
# In production, restrict CORS to specific origins
# Edit backend/app.py to use:
# allow_origins=os.getenv("ALLOWED_ORIGINS", "").split(",")
# Instead of: allow_origins=["*"]

# Example .env:
# ALLOWED_ORIGINS=https://app.example.com,https://www.example.com

# ============================================================================
# 3. RATE LIMITING
# ============================================================================
# Implement rate limiting to prevent abuse
#
# Recommended limits:
# - WebSocket connections: 10 per IP per minute
# - API requests: 100 per IP per minute
# - Historical data requests: 5 per IP per hour
#
# Implementation: Use slowapi or fastapi-limiter

# ============================================================================
# 4. TLS/SSL CONFIGURATION
# ============================================================================
# Always use HTTPS in production
#
# Nginx example:
# server {
#     listen 443 ssl http2;
#     server_name futures-charting.example.com;
#
#     ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#
#     location / {
#         proxy_pass http://localhost:8000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection "upgrade";
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }

# ============================================================================
# 5. FIREWALL RULES
# ============================================================================
# Configure firewall to allow only necessary ports
#
# ufw allow 22/tcp    # SSH
# ufw allow 80/tcp    # HTTP (redirect to HTTPS)
# ufw allow 443/tcp   # HTTPS
# ufw enable

# Block direct access to application port:
# ufw deny 8000/tcp

# ============================================================================
# 6. FILE PERMISSIONS
# ============================================================================
# Set appropriate file permissions
#
# Application directory:
# chown -R www-data:www-data /opt/futures-charting
# chmod -R 755 /opt/futures-charting
# chmod -R 700 /opt/futures-charting/.env
# chmod -R 700 /opt/futures-charting/data
# chmod -R 700 /opt/futures-charting/logs

# ============================================================================
# 7. SECRETS MANAGEMENT
# ============================================================================
# Never hardcode secrets
# Use one of:
# - Environment variables
# - AWS Secrets Manager
# - HashiCorp Vault
# - Azure Key Vault
# - Google Cloud Secret Manager

# ============================================================================
# 8. LOGGING AND MONITORING
# ============================================================================
# Log security events:
# - Failed authentication attempts
# - Rate limit violations
# - Invalid WebSocket connections
# - Suspicious API requests
#
# Send logs to centralized service:
# - ELK Stack (Elasticsearch, Logstash, Kibana)
# - Splunk
# - Datadog
# - CloudWatch

# ============================================================================
# 9. DATABASE SECURITY (if applicable)
# ============================================================================
# - Use strong passwords
# - Enable SSL/TLS for database connections
# - Restrict database access to application server IP
# - Regular backups with encryption
# - Use prepared statements (prevents SQL injection)

# ============================================================================
# 10. DEPENDENCY SECURITY
# ============================================================================
# Regularly update dependencies:
# pip list --outdated
# pip install --upgrade <package>
#
# Scan for vulnerabilities:
# pip install safety
# safety check
#
# Use dependabot (GitHub) for automated dependency updates

# ============================================================================
# 11. AUTHENTICATION (Future Enhancement)
# ============================================================================
# For multi-user deployments, implement authentication:
# - JWT tokens
# - OAuth 2.0
# - API keys
# - Session management

# ============================================================================
# 12. INPUT VALIDATION
# ============================================================================
# Always validate user input:
# - Symbol names (whitelist: MNQ, MES, MGC)
# - Time ranges
# - Indicator parameters
# - WebSocket messages

# ============================================================================
# 13. SECURITY HEADERS
# ============================================================================
# Add security headers to all responses:
# X-Content-Type-Options: nosniff
# X-Frame-Options: DENY
# X-XSS-Protection: 1; mode=block
# Strict-Transport-Security: max-age=31536000; includeSubDomains
# Content-Security-Policy: default-src 'self'

# ============================================================================
# 14. REGULAR SECURITY AUDITS
# ============================================================================
# Schedule regular security audits:
# - Code reviews
# - Penetration testing
# - Dependency scans
# - Access log reviews
# - Certificate renewals

# ============================================================================
# 15. INCIDENT RESPONSE PLAN
# ============================================================================
# Have a plan for security incidents:
# 1. Detection and analysis
# 2. Containment
# 3. Eradication
# 4. Recovery
# 5. Post-incident review
